// Document.ready is too early for this
function validateEmail(e){var t=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;return t.test(e)?!0:!1}function setCookie(e,t,n){var r=new Date;r.setTime(r.getTime()+n*24*60*60*1e3);var i="expires="+r.toGMTString();document.cookie=e+"="+t+"; "+i}function getCookie(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r].trim();if(i.indexOf(t)==0)return i.substring(t.length,i.length)}return""}window.onload=function(){if(typeof tinyMCE!="undefined")if(tinyMCE.activeEditor==null||tinyMCE.activeEditor.isHidden()!=0){tinyMCE.activeEditor.onKeyUp.add(function(){var e=this.getContent(),t=this.id,n=jQuery("span[data-field="+t+"]").data("selector");jQuery(n).html(e)});tinymce.activeEditor.onChange.add(function(){var e=this.getContent(),t=this.id,n=jQuery("span[data-field="+t+"]").data("selector");jQuery(n).html(e)})}};jQuery(document).ready(function(e){e(".datepicker").length>0&&e(".datepicker").datepicker();e(".customiser").length>0&&e(".customiser").resizable({maxWidth:700,minWidth:300,resize:function(t,n){e("body.customiser-open").css("margin-left",n.size.width);setCookie("customiser-width",n.size.width,365)}});var t=getCookie("customiser");if("open"==t){e(".customiser").show();e("body").addClass("customiser-open")}var n=getCookie("customiser-width");if(n>0){e("body.customiser-open").css("margin-left",n);e(".customiser").css("width",n)}e(".customiser-open-button, .customiser-close-button").click(function(){if(e(".customiser").is(":hidden")){e("body").addClass("customiser-open");e(".customiser").show();setCookie("customiser","open",365)}else{e("body").removeClass("customiser-open");e(".customiser").hide();setCookie("customiser","close",365)}});e(".meta-box input, .meta-box textarea").keyup(function(){e(this).parent().find(".dashicons-yes, .loading").hide();e(this).parent().find(".dashicons-update").show();var t=e(this).val(),n=e(this).parent().find(".dashicons-update").data("selector");e(n).text(t);var r=e(n).offset();e("#wpadminbar").length>0&&(r.top=r.top-40);e("body").animate({scrollTop:r.top})});e(".meta-box select").change(function(){e(this).parent().find(".dashicons-yes, .loading").hide();e(this).parent().find(".dashicons-update").show();var t=e(this).val(),n=e(this).parent().find(".dashicons-update").data("selector");e(n).text(t)});e(".dashicons-star-empty, .dashicons-star-filled").click(function(){e(this).toggleClass("dashicons-star-empty");e(this).toggleClass("dashicons-star-filled")});e(".lu-update").click(function(){var t=e(this),n=t.data("field"),r=t.data("selector"),i=t.data("type"),s=t.data("taxonomy"),o="";switch(i){case"select":var o=e("select[name=lu_"+n).val();break;case"author":var o=e("select[name=lu_"+n).val();break;case"textarea":var o=e("textarea[name=lu_"+n).val();break;case"content":var o=tinymce.get(n).getContent();break;case"wysiwyg":var o=tinymce.get(n).getContent();break;case"checkbox":var u=e("input[name=lu_"+n);1==e(u).prop("checked")&&(o=1);break;case"taxonomy":e('input[name^="lu_'+n+'"]:checked').each(function(t){o+=e(this).val()+","});o=o.substring(0,o.length-1);break;case"featured":var a=e("#lu_featured");e(a).hasClass("dashicons-star-filled")&&(o=1);break;case"featured-image":var o=e("input[name=featured-image-id]").val();break;default:var o=e("input[name=lu_"+n).val()}if("email"==i){if(!validateEmail(o)){e("input[name=lu_"+n).addClass("error");return}e("input[name=lu_"+n).removeClass("error")}t.hide();e("#loading-"+n).show();e("#lu_"+n).prop("disabled",!0);var f={action:"lu_update_value",nonce:lu.nonce,post_id:lu.post_id,field_id:n,field_type:i,new_value:o,taxonomy:s};e.post(lu.ajaxurl,f,function(t){e(".loading").hide();e("#success-"+n).show();e("#lu_"+n).prop("disabled",!1)})});var r;e(".upload_image_button").live("click",function(t){t.preventDefault();if(r){r.open();return}r=wp.media.frames.file_frame=wp.media({title:"Choose Image",library:{type:"image"},button:{text:"Choose an Image"},multiple:!1});r.on("select",function(){attachment=r.state().get("selection").first().toJSON();attachment.sizes.length>0?e(".featured-image").attr("src",attachment.sizes.medium.url):e(".featured-image").attr("src",attachment.url);e(".attachment-post-thumbnail").attr("src",attachment.url);e("input[name=featured-image-id]").val(attachment.id);e(".upload_image_button").hide();e(".existing-image").show()});r.open()})});